# This file autogenerated by Chef
# Do not edit, changes will be overwritten

<% @params[:port].each do |port| -%>
Listen <%= @params[:ip_address] %>:<%= port %>

<VirtualHost  <%= @params[:ip_address] %>:<%= port %>>
  ServerName <%= @params[:name] %>

  SSLEngine On
  SSLCertificateFile <%= @params[:cert_file] %>
  SSLCertificateKeyFile <%= @params[:cert_key] %>
  <% if @params[:cert_chain] %>SSLCertificateChainFile <%= @params[:cert_chain] %><% end %>
  SSLProtocol           +SSLv3 +TLSv1
  SSLCipherSuite        HIGH:!RC4:!MD5:!aNULL:!eNULL:!EXP:!LOW:!MEDIUM

  RequestHeader   set   X-Forwarded-Proto "https"

  ProxyRequests off
  ProxyPreserveHost on
  ProxyPass / http://127.0.0.1:<%= port %>/
  ProxyPassReverse / http://127.0.0.1:<%= port %>/

  <Proxy http://127.0.0.1:<%= port %>/>
    AddDefaultCharset off
    Order deny,allow
    Allow from all
  </Proxy>

  LogLevel info
  CustomLog "|/usr/sbin/rotatelogs <%= node['apache']['log_dir'] %>/<%= @params[:name] %>/access/%Y%m%d.log 86400" combined
  ErrorLog "|/usr/sbin/rotatelogs <%= node['apache']['log_dir'] %>/<%= @params[:name] %>/error/%Y%m%d.log 86400"
</VirtualHost>

<% end -%>
